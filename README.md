The actual code can be found in the branch newBranch. 
